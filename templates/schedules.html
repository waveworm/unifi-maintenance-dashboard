<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedules - UniFi Maintenance Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="/static/schedules.css">
</head>
<body data-scheduler-timezone="{{ scheduler_timezone }}">
    <header>
        <div class="container">
            <h1>üéØ UniFi Maintenance Dashboard</h1>
            <nav class="header-nav">
                <a href="/" class="nav-link">üè† Dashboard</a>
                <a href="/schedules" class="nav-link active">üìÖ Schedules</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="page-header">
            <div>
                <h2>Scheduled Maintenance</h2>
                <p class="timezone-note">Scheduler timezone: {{ scheduler_timezone }}</p>
            </div>
            <button class="btn btn-primary" id="newScheduleBtn">+ New Schedule</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="device-schedules">Device Reboots</button>
            <button class="tab-btn" data-tab="port-schedules">Port Cycles</button>
            <button class="tab-btn" data-tab="job-history">Job History</button>
            <button class="tab-btn" data-tab="templates">Templates</button>
        </div>

        <!-- Device Reboot Schedules -->
        <div id="device-schedules" class="tab-content active">
            <div id="schedulesList" class="schedules-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading schedules...
                </div>
            </div>
        </div>

        <!-- Port Cycle Schedules -->
        <div id="port-schedules" class="tab-content">
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" id="newPortScheduleBtn">+ New Port Cycle Schedule</button>
            </div>
            <div id="poeSchedulesList" class="schedules-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading port schedules...
                </div>
            </div>
        </div>

        <!-- Job History -->
        <div id="job-history" class="tab-content">
            <div id="jobsList" class="jobs-list">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading job history...
                </div>
            </div>
        </div>

        <!-- Schedule Templates -->
        <div id="templates" class="tab-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <p style="color:var(--text-secondary);font-size:14px;">Save reusable schedule configurations. Load a template when creating a new schedule to pre-fill timing and mode settings.</p>
                <button class="btn btn-primary" id="newTemplateBtn">+ New Template</button>
            </div>
            <div id="templatesList" class="template-grid">
                <div class="loading"><div class="spinner"></div> Loading templates...</div>
            </div>
        </div>
    </main>

    <!-- New Schedule Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Create Device Reboot Schedule</h3>
                <div style="display:flex;gap:8px;align-items:center;">
                    <button type="button" class="btn btn-sm template-load-btn" id="loadTemplateForSchedule" data-for="device_reboot">üìã Load Template</button>
                    <button class="close-btn">&times;</button>
                </div>
            </div>
            <form id="scheduleForm">
                <div class="form-group">
                    <label>Schedule Name *</label>
                    <input type="text" name="name" required placeholder="e.g., Weekly Switch Maintenance">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="2" placeholder="Optional description"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Site *</label>
                        <select id="scheduleSiteSelector" required>
                            <option value="">Select site...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Frequency *</label>
                        <select name="frequency" id="frequencySelect" required>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="hourly">Hourly</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Time of Day</label>
                        <input type="time" name="time_of_day" value="02:00">
                    </div>

                    <div class="form-group" id="dayOfWeekGroup" style="display: none;">
                        <label>Day of Week</label>
                        <select name="day_of_week">
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>

                    <div class="form-group" id="dayOfMonthGroup" style="display: none;">
                        <label>Day of Month</label>
                        <input type="number" name="day_of_month" min="1" max="31" value="1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Select Devices *</label>
                    <div id="deviceSelector" class="device-selector">
                        <div class="loading">Loading devices...</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="rolling_mode" id="rollingModeCheck">
                        Rolling Mode (reboot one device at a time)
                    </label>
                </div>

                <div id="rollingOptions" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Delay Between Devices (seconds)</label>
                            <input type="number" name="delay_between_devices" min="0" value="60">
                        </div>

                        <div class="form-group">
                            <label>Max Wait Time (seconds)</label>
                            <input type="number" name="max_wait_time" min="0" value="300">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="continue_on_failure">
                            Continue on failure
                        </label>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn close-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Port Cycle Schedule Modal -->
    <div id="portScheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Port Cycle Schedule</h3>
                <div style="display:flex;gap:8px;align-items:center;">
                    <button type="button" class="btn btn-sm template-load-btn" id="loadTemplateForPort" data-for="port_cycle">üìã Load Template</button>
                    <button class="close-btn">&times;</button>
                </div>
            </div>
            <form id="portScheduleForm">
                <div class="form-group">
                    <label>Schedule Name *</label>
                    <input type="text" name="name" required placeholder="e.g., Daily Camera Port Cycle">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="2" placeholder="Optional description"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Site *</label>
                        <select id="portScheduleSiteSelector" required>
                            <option value="">Select site...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Device *</label>
                        <select id="portScheduleDeviceSelector" required disabled>
                            <option value="">Select site first...</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Port Number *</label>
                        <input type="number" name="port_idx" min="1" max="48" required placeholder="1-48">
                    </div>

                    <div class="form-group">
                        <label>Cycle Type *</label>
                        <select name="poe_only" required>
                            <option value="true">PoE Only (power cycle)</option>
                            <option value="false">Full Port (disable/enable)</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Frequency *</label>
                        <select name="frequency" id="portFrequencySelect" required>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="hourly">Hourly</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Time of Day</label>
                        <input type="time" name="time_of_day" value="02:00">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" id="portDayOfWeekGroup" style="display: none;">
                        <label>Day of Week</label>
                        <select name="day_of_week">
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>

                    <div class="form-group" id="portDayOfMonthGroup" style="display: none;">
                        <label>Day of Month</label>
                        <input type="number" name="day_of_month" min="1" max="31" value="1">
                    </div>

                    <div class="form-group">
                        <label>Off Duration (seconds)</label>
                        <input type="number" name="off_duration" min="5" max="300" value="15">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn close-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Schedule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template Create/Edit Modal -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="templateModalTitle">New Schedule Template</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="templateForm">
                <div class="form-group">
                    <label>Template Name *</label>
                    <input type="text" name="name" required placeholder="e.g., Nightly AP Reboot">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" rows="2" placeholder="What is this template used for?"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Template Type *</label>
                        <select name="template_type" id="templateTypeSelect" required>
                            <option value="device_reboot">Device Reboot</option>
                            <option value="port_cycle">Port Cycle</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Frequency *</label>
                        <select name="frequency" id="templateFrequencySelect" required>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="hourly">Hourly</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Time of Day</label>
                        <input type="time" name="time_of_day" value="02:00">
                    </div>

                    <div class="form-group" id="tmplDayOfWeekGroup" style="display:none;">
                        <label>Day of Week</label>
                        <select name="day_of_week">
                            <option value="0">Monday</option>
                            <option value="1">Tuesday</option>
                            <option value="2">Wednesday</option>
                            <option value="3">Thursday</option>
                            <option value="4">Friday</option>
                            <option value="5">Saturday</option>
                            <option value="6">Sunday</option>
                        </select>
                    </div>

                    <div class="form-group" id="tmplDayOfMonthGroup" style="display:none;">
                        <label>Day of Month</label>
                        <input type="number" name="day_of_month" min="1" max="31" value="1">
                    </div>
                </div>

                <!-- Device Reboot specific fields -->
                <div id="tmplDeviceRebootFields">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="rolling_mode" id="tmplRollingMode">
                            Rolling Mode (reboot one device at a time)
                        </label>
                    </div>
                    <div id="tmplRollingOptions" style="display:none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Delay Between Devices (seconds)</label>
                                <input type="number" name="delay_between_devices" min="0" value="60">
                            </div>
                            <div class="form-group">
                                <label>Max Wait Time (seconds)</label>
                                <input type="number" name="max_wait_time" min="0" value="300">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="continue_on_failure">
                                Continue on failure
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Port Cycle specific fields -->
                <div id="tmplPortCycleFields" style="display:none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Cycle Type</label>
                            <select name="poe_only">
                                <option value="true">PoE Only (power cycle)</option>
                                <option value="false">Full Port (disable/enable)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Off Duration (seconds)</label>
                            <input type="number" name="off_duration" min="5" max="300" value="15">
                        </div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn close-btn">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="templateSubmitBtn">Save Template</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template Picker Modal -->
    <div id="templatePickerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Load a Template</h3>
                <button class="close-btn">&times;</button>
            </div>
            <p style="color:var(--text-secondary);font-size:14px;margin-bottom:16px;">
                Select a template to pre-fill the form. You can still edit any values after loading.
            </p>
            <div id="templatePickerList" class="template-picker-list"></div>
            <div class="modal-actions">
                <button class="btn close-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/static/schedules.js?v=20260226001"></script>
</body>
</html>
